---
import Layout from "../layouts/Layout.astro";

interface Category {
    name: string;
}

interface ArticleData {
    id: string;
    title: string;
    authors: { username: string }[];
    content: string;
    views: string;
    summary: string;
    categories: Category[];
    thumb: string;
    description?: string;
}

interface Article {
    success: boolean;
    data: ArticleData;
}

const id = Astro.params.id;
let article: Article | null = null;

try {
    const response = await fetch(`http://127.0.0.1:8000/api/articles/${id}`);
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    article = await response.json();
    console.log("Article data:", article);
} catch (error) {
    console.error("Error fetching article:", error);
}
---

<Layout
    title={article?.data?.title ?? ""}
    description={article?.data?.description ?? ""}
>
    <main class="">
        <a href="/">Back</a>
        {
            article?.data ? (
                <article>
                    <div>
                        <ul>
                            {article?.data?.categories.map((category) => (
                                <li>
                                    <a href={`/${category.name}`}>
                                        {category.name}
                                    </a>
                                </li>
                            ))}
                        </ul>
                        <h1>{article.data.title}</h1>
                        <p>{article.data.summary}</p>

                        <div>
                            <img
                                src={`${article.data.thumb}`}
                                alt=""
                                width="720"
                                height="480"
                            />
                        </div>
                        <div set:html={article.data.content} />
                    </div>
                </article>
            ) : (
                <p>
                    {article === null
                        ? "Error loading article. Please try again."
                        : "Article not found."}
                </p>
            )
        }
    </main>
</Layout>
